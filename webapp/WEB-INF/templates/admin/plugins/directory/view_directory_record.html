<#-- 
-- Return true if the given entry is an entry type Image
-- @param entry the entry to check
-- @return true if the entry is an entry type Image
-->
<#function isEntryTypeImage entry>
	<#return entry.entryType?has_content && entry.entryType.idType?has_content && entry.entryType.idType == id_entry_type_image>
</#function>

<#-- 
-- Return true if the given entry is an entry type MyLuteceUser
-- @param entry the entry to check
-- @return true if the entry is an entry type MyLuteceUser
-->
<#function isEntryTypeMyLuteceUser entry>
	<#return entry.entryType?has_content && entry.entryType.idType?has_content && entry.entryType.idType == id_entry_type_mylutece_user>
</#function>

<#-- 
-- Return true if the given entry is an entry type Geolocation
-- @param entry the entry to check
-- @return true if the entry is an entry type Geolocation
-->
<#function isEntryTypeGeolocation entry>
	<#return entry.entryType?has_content && entry.entryType.idType?has_content && entry.entryType.idType == id_entry_type_geolocation>
</#function>

<#--
-- Build the HTML of the given record field
-- @param entry the entry of the record field
-- @param recordfield the recordfield
-- @param first true if the record field is the first record field of the list of record fields of the given entry
-- @return the HTLM code of the record field
-->
<#macro getRecordFieldHtml entry recordfield first>
	<#if isEntryTypeGeolocation( entry )>
		${entry.getHtmlRecordFieldValue( locale, recordfield, false )}
		<#if recordfield.field.title == 'address' && recordfield.value?has_content>
			<div class="form-element">
				<#include "../../../skin/plugins/directory/" + entry.mapProvider.frontHtmlCode />
				<br />
			</div>
		</#if>
	<#else>
		<#if !first>
			<label>&nbsp;</label>
		</#if>
		<#if isEntryTypeImage( entry )>    						
			<#if recordfield.field?? & recordfield.field.isShownInResultRecord(  )>
				${entry.getHtmlRecordFieldValue( locale, recordfield, false )}
			</#if>
		<#elseif isEntryTypeMyLuteceUser(entry) && !permission_visualisation_mylutece_user>
			${record_field.value}
		<#else>
			${entry.getHtmlRecordFieldValue( locale,recordfield, false )}
		</#if>
		<br/>
		<br/>
	</#if>
</#macro>

<#--
-- Build the HTML code to display the actions
-- @param resource_actions the actions to display
-- @return the HTML code of the actions
-->
<#macro display_actions resource_actions >
	<#if resource_actions.workflow_action_list?exists>
		<#list resource_actions.workflow_action_list as action>
			<a href="jsp/admin/plugins/directory/DoProcessActionWorkflow.jsp?id_action=${action.id}&amp;id_directory_record=${resource_actions.record.idRecord}&amp;id_directory=${directory.idDirectory}">	
				<img src="image?resource_type=workflow_icon_img&id=${action.icon.id}"
					<#if action.icon.width!=-1>
						width="${action.icon.width}"
 					</#if> 
					<#if action.icon.height!=-1>
						height="${action.icon.height}"
					</#if> 
					title="${action.name}" alt="${action.name}"
				/>
			</a>
		</#list>
	</#if>
	<#list resource_actions.record.actions as action>
		<#if (action.nameKey!="directory.action.history.name") || (action.nameKey=="directory.action.history.name" && history_workflow)>
	 		<a href="${action.url}?id_directory_record=${resource_actions.record.idRecord}&amp;id_directory=${directory.idDirectory}">
	  			<img src="${action.iconUrl}" alt="${action.name}" title="${action.description}">
	  		</a>
		</#if>
	</#list>
</#macro>

<div id="left">
	<div class="content-box">
		<h2>#i18n{directory.viewing_directory_record.labelRecord} ${record.idRecord}</h2>
		<table>
			<tr>
				<th>#i18n{directory.viewing_directory_record.labelDirectory}</th>
			</tr>
			<tr>
				<td>${directory.title}</td>
			</tr>
			<#if resource_actions.workflow_state?exists>
				<tr>
					<th>#i18n{directory.viewing_directory_record.labelState}</th>
				</tr>
				<tr>
					<td>${resource_actions.workflow_state.name}</td>
				</tr>
			</#if>
			<tr>
				<th>#i18n{directory.viewing_directory_record.actions}</th>
			</tr>
			<tr>
				<td>
					<#if item_navigator??>
						<@item_navigation item_navigator=item_navigator />
					</#if>
					<@display_actions resource_actions/>
				</td>
			</tr>
		</table>
	</div>
</div>
<div id="right">
	<div class="content-box">
		<h2>
			#i18n{directory.viewing_directory_record.title} : '${directory.title}'
	  		<#if record.dateCreation?? && show_date_creation_record > - #i18n{directory.viewing_directory_record.date_creation} ${record.dateCreation}</#if>
	  		<#if record.dateModification?? && show_date_modification_record > - #i18n{directory.viewing_directory_record.date_modification} ${record.dateModification}</#if>
		</h2>
	  <div id="form-content">
			<input name="page" value="directory" type="hidden" />
			
			 <#list entry_list as entry>	
	      			<#if entry.entryType.group>	
	      			  	<fieldset class="form-fieldset"> 
	    					<legend class="form-legend"> ${entry.title} </legend>
	      					<#if entry.children?has_content>
	      						<#list entry.children as child >
									<div class="clear">
		      							<#if child.title?exists>
			      							<label for="">${child.title} : </label>
			      						 </#if> 	
		      							<#assign entryKey=""+child.idEntry>	
		      							<#assign first = true>
		      							<#list map_id_entry_list_record_field[entryKey] as recordfield>
		      								<@getRecordFieldHtml entry=child recordfield=recordfield first=first />
		      						 		<#assign first = false>
	      								</#list>
		      						</div>
	      						</#list>
	      					</#if>
	      				</fieldset>		
	      			<#else>
	      				<div class="clear">
		      				<#assign entryKey=""+entry.idEntry>	
	    					<#assign first = true>
		      				<#if entry.title?exists>
		      					<label for="">${entry.title} : </label>
		      				</#if>	
		      				<#list map_id_entry_list_record_field[entryKey] as recordfield>
	    						<@getRecordFieldHtml entry=entry recordfield=recordfield first=first />
	   							<#assign first = false>
	    					</#list>
    					</div>
	      			</#if>
	      		</#list>
	      		<br />
	      		<form action="jsp/admin/plugins/directory/ManageDirectoryRecord.jsp" method="get">
			  		<input type="hidden" name="id_directory" value="${directory.idDirectory}" />
			  		<input type="hidden" name="session" value="session" />
					<input class="button" type="submit" value="#i18n{directory.resource_history.buttonBack}" />
			  	</form>
		</div>
	</div>
</div>
<div class="clear">&nbsp;</div>

<script language="JavaScript" type="text/javascript">
//for datepicker questions
$(document).ready(function () 
{
	var locale = "en-US";
	if(document.getElementById("locale") != null)
	{
		locale = document.getElementById("locale").innerHTML;
	}

	$.datepicker.setDefaults({
		showOn: 'button', 
		buttonImageOnly: true, 
		buttonImage: 'js/jquery/plugins/ui/datepicker/calendar.png', 
		buttonText: 'Calendar', 
		showAnim: 'slideDown', 
		speed: 'fast'
	});

	$( ".datepicker-element" ).each(function( i ){
		/*$(this).datepicker($.extend({showStatus: true}, $.datepicker.regional[locale]));*/
		$(this).datepicker();
	});
});
</script>
