<#include "/admin/plugins/directory/commons.html" />
<div class="row-fluid">
	<div class="span8">
	<fieldset>
		<legend>
		#i18n{directory.modify_entry.title_field} : '${entry.directory.title}' 
		<span class="label label-info" title="#i18n{directory.create_entry.label_type}">#i18n{${entry.entryType.titleI18nKey}}</span>
		<a class="btn btn-primary btn-small pull-right" href="jsp/admin/plugins/directory/ModifyDirectory.jsp?id_directory=${entry.directory.idDirectory}#list" title="#i18n{directory.manage_directory.button_back} #i18n{directory.modify_directory.manage_entry.title} '${entry.directory.title}'">
			<i class="icon-chevron-left icon-white"></i>
		</a><form class="form-inline pull-right" id="button_advanced_settings" method="post" action="javascript:doDisplayAdvancedSettings(true, 'regular_expression')" style="visibility:hidden;display:none;">
			<button class="btn btn-primary pull-right" type="submit" >
				<i class="icon-plus icon-white" ></i>
				<span class="hidden-phone" >#i18n{directory.manage_directory.button_manage_advanced_parameters}</span>
			</button>
		</form>	
		<form class="form-inline spaced pull-right" id="button_back" method="post" action="javascript:doDisplayAdvancedSettings(false, 'regular_expression')" style="visibility:hidden;display:none;">
			<button class="btn btn-primary pull-right" type="submit" >
				<i class="icon-plus icon-white" ></i>
				<span class="hidden-phone" >#i18n{directory.manage_directory.button_back}</span>
			</button>
		</form>	
		</legend>
		<form class="form-horizontal" action="jsp/admin/plugins/directory/DoModifyEntry.jsp#list" method="post" name="" id=""  >
		<input name="id_entry" value="${entry.idEntry}" type="hidden" />
		<div class="control-group">
		<label class="control-label" for="title">#i18n{directory.create_entry.label_title} * </label>
			<div class="controls">
				<input type="text" name="title" id="title" class="input-xlarge" value="${entry.title}"  maxlength="255" />
				<p class="help-block">#i18n{directory.create_entry.label_title_comment}</p>
			</div>
		</div>
		<div class="control-group">
			<label class="control-label" for="help_message">#i18n{directory.create_entry.label_help_message}</label>
			<div class="controls">
				<textarea  name="help_message"  id="help_message" class="span5" rows="3">${entry.helpMessage}</textarea>
				<p class="help-block">#i18n{directory.create_entry.label_help_message_comment}</p>
			</div>
		</div>
		<div class="control-group">
			<label class="control-label" for="help_message_search">#i18n{directory.create_entry.label_help_message_search} </label>
				<div class="controls">
					<textarea  name="help_message_search"  id="help_message_search"  class="span5" rows="3">${entry.helpMessageSearch}</textarea>
					<p class="help-block">#i18n{directory.create_entry.label_help_message_search_comment}</p>
			</div>
		</div>
		<div class="control-group">
			<label class="control-label" for="comment"> #i18n{directory.create_entry.label_comment}</label>
			<div class="controls">
				<textarea name="comment"  class="span5"" rows="2">${entry.comment}</textarea>
			</div>
		</div>
		<div class="control-group">
			<label class="control-label" for="id_entry_associate">#i18n{directory.create_entry.label_entry} *</label>
			<div class="controls">
				<@combo name="id_entry_associate"  items=directory_entry_list_associate default_value=entry.entryAssociate/>
				<span class="help-text" >#i18n{directory.create_entry.label_entry_comment}</span>
			</div>
		</div>
		<div class="control-group">
			<label class="control-label" for="">&nbsp;</label>
			<div class="controls">
				<label class="checkbox" for="mandatory">
					<input name="mandatory" value="1" type="checkbox" <#if entry.mandatory>checked="checked"</#if> >
					#i18n{directory.create_entry.label_mandatory}
				</label>
			</div>
		</div>
		<div class="form-actions">
				<button class="btn btn-primary  btn-small" type="submit" >
					<i class="icon-ok icon-white" ></i>
					<span class="hidden-phone" >#i18n{directory.modify_entry.button_save}</span>
				</button>
				<button class="btn btn-primary btn-small" type="submit" >
					<i class="icon-ok-circle icon-white" ></i>
					<span class="hidden-phone" >#i18n{directory.modify_entry.button_apply}</span>
				</button>
				<a class="btn btn-small" href="jsp/admin/plugins/directory/ModifyDirectory.jsp?id_directory=${entry.directory.idDirectory}">
					<i class="icon-remove-circle" ></i>
					<span class="hidden-phone" >#i18n{directory.modify_entry.button_cancel}</span>
				</a>
		</div>
	</fieldset>
	</div>
	<div id="advanced_settings" class="span4">
	<fieldset>
		<legend>#i18n{directory.create_directory.label_advancedsettings}</legend>
		<div class="control-group">
			<label class="control-label" for=""></label>
			<div class="controls">
			<label class="checkbox" for="is_all_search">
				<input id="is_all_search" name="is_all_search" value="1" type="checkbox" <#if entry.addValueAllSearch>checked="checked"</#if> onclick="javascript:addAllSearch();" >
					#i18n{directory.create_entry.label_is_all_search}
				</label>
				<p class="help-block" >#i18n{directory.create_entry.label_is_all_search_comment}</p>
				<div id="label_value_all_search">
					<label class="control-label" for="label_all_search">#i18n{directory.create_entry.label_label_all_search} : </label>
					<input type="text" name="label_all_search" id="label_all_search" class="input-xlarge" value="<#if entry.labelValueAllSearch??>${entry.labelValueAllSearch}</#if>"  maxlength="255"/>
				</div>
			</div>
		</div>
		<div class="control-group">
			<label class="control-label" for=""></label>
	   		<div class="controls">
				<label class="checkbox" for="indexed">
					<input name="indexed" value="1" type="checkbox"  <#if entry.indexed>checked="checked"</#if> >
					#i18n{directory.create_entry.label_indexed}
				</label>
			</div>
		</div>
		<div class="control-group">
			<label class="control-label" for=""></label>
			<div class="controls">
				<label class="checkbox" for="shown_in_advanced_search">
					<input name="shown_in_advanced_search" value="1" type="checkbox" <#if entry.shownInAdvancedSearch>checked="checked"</#if>>
					#i18n{directory.create_entry.label_shown_in_advanced_search}
				</label>
				<p class="help-block">#i18n{directory.create_entry.label_shown_in_advanced_search_comment}</p>
			</div>
		</div>
		<div class="control-group">
			<label class="control-label" for=""></label>
            <div class="controls">
				<label class="checkbox" for="indexed_as_title">
					<input name="indexed_as_title" value="1" type="checkbox" <#if entry.indexedAsTitle>checked="checked"</#if>>
					#i18n{directory.create_entry.label_indexed_as_title}
				</label>
			</div>
		</div>
        <div class="control-group">
		<label class="control-label" for=""></label>
            <div class="controls">
				<label class="checkbox" for="indexed_as_summary">
					<input name="indexed_as_summary" value="1" type="checkbox" <#if entry.indexedAsSummary>checked="checked"</#if>>
					#i18n{directory.create_entry.label_indexed_as_summary}
				</label>
			</div>
		</div>
        <div class="control-group">
		<label class="control-label" for=""></label>
			<div class="controls">
				<label class="checkbox" for="shown_in_result_list">
					<input name="shown_in_result_list" value="1" type="checkbox" <#if entry.shownInResultList>checked="checked"</#if>>
					#i18n{directory.create_entry.label_shown_in_result_list}
				</label>
				<p class="help-block">#i18n{directory.create_entry.label_shown_in_result_list_comment}</p>
			</div>
		</div>
		<div class="control-group">
			<label class="control-label" for=""></label>
	   		<div class="controls">
				<label class="checkbox" for="shown_in_result_record">
					<input name="shown_in_result_record" value="1" type="checkbox" <#if entry.shownInResultRecord>checked="checked"</#if>>
					#i18n{directory.create_entry.label_shown_in_result_record}
				</label>
				<p class="help-block">#i18n{directory.create_entry.label_shown_in_result_record_comment}</p>
			</div>
		</div>
		<div class="control-group">
		<label class="control-label" for=""></label>
			<div class="controls">
				<label class="checkbox" for="shown_in_history">
				<input name="shown_in_history" value="1" type="checkbox" <#if entry.shownInHistory>checked="checked"</#if>>
				#i18n{directory.create_entry.label_shown_in_history}</label>
				<p class="help-block">#i18n{directory.create_entry.label_shown_in_history_comment}</p>
			</div>
		</div>
		<div class="control-group">
		<label class="control-label" for=""></label>
			<div class="controls">
				<label class="checkbox" for="shown_in_export">
				<input name="shown_in_export" value="1" type="checkbox" <#if entry.shownInExport>checked="checked"</#if>>
					#i18n{directory.create_entry.label_shown_in_export}
				</label>
				<p class="help-block">#i18n{directory.create_entry.label_shown_in_export_comment}</p>
			</div>
		</div>
		<div class="control-group">
			<label class="control-label" for=""></label>
	    	<div class="controls">
				<label class="checkbox" for="shown_in_completeness">
				<input name="shown_in_completeness" value="1" type="checkbox" <#if entry.shownInCompleteness>checked="checked"</#if>>
				#i18n{directory.create_entry.label_shown_in_completeness}</label>
				<p class="help-block">#i18n{directory.create_entry.label_shown_in_completeness_comment}</p>
			</div>
		</div>
	</div>
 </fieldset>
</form>
</div>
<script>
function addAllSearch()	{
	if( $("#is_all_search:checked").length > 0 ){
		$("#label_value_all_search").show();
	} else {
		$("#label_value_all_search").hide();
	}
}
$(document).ready(function () {
	addAllSearch(); 
	$("#is_all_search").click( function(){
		addAllSearch();
	});
});

/* TODO check js code */
 function select_associate()
 {
	var form = document.getElementById("settings");
	var entry = form.childNodes[13];
	form.removeChild(entry);

	var p = document.createElement("p");

	var label = document.createElement("label");
	label.innerHTML="#i18n{directory.create_entry.label_directory} * : ";
	
	var listDirectory = document.createElement("select");
	var name = document.createAttribute("name");
	name.nodeValue = "id_directory_associate";
	listDirectory.setAttributeNode(name);

	<#list directory_list_associate as directory>	
	var option${directory.code} = document.createElement("option");
	option${directory.code}.text="${directory.name}";
	
	var value${directory.code} = document.createAttribute("value");
	value${directory.code}.nodeValue = "${directory.code}";

	var onclick${directory.code} = document.createAttribute("onclick");
	onclick${directory.code}.nodeValue = "refresh_list(${directory.code})";

	<#if id_directory_associate?string=directory.code>
		var selected${directory.code} = document.createAttribute("selected");
		selected${directory.code}.nodeValue = "selected";
		option${directory.code}.setAttributeNode(selected${directory.code});
	</#if>
	option${directory.code}.setAttributeNode(value${directory.code});
	option${directory.code}.setAttributeNode(onclick${directory.code});

	listDirectory.appendChild(option${directory.code});
	</#list>
	
	p.appendChild(label);
	p.appendChild(listDirectory);
	
	form.insertBefore(p,form.childNodes[12]);
	
 }

 function refresh_list(id_directory)
 {
	 if(document.getElementById("id_entry_associate")!=null)
	 {
		 var parent = document.getElementById("id_entry_associate").parentNode;
		 while (parent.firstChild) {
			 parent.removeChild(parent.firstChild);
		 }
	 }
	 
		 var bool = false;
		 var form = document.getElementById("settings");
		 var listEntry = document.createElement("select");

		 var name = document.createAttribute("name");
		 name.nodeValue = "id_entry_associate";
		 listEntry.setAttributeNode(name);

		 var id = document.createAttribute("id");
		 id.nodeValue = "id_entry_associate";
		 listEntry.setAttributeNode(id);

		 var p = document.createElement("p");

		var label = document.createElement("label");
		label.innerHTML="#i18n{directory.create_entry.label_entry} * : ";

		var label2 = document.createElement("label");
		label2.innerHTML="&nbsp;";

		var text = document.createTextNode("#i18n{directory.create_entry.label_entry_comment}"); 
		
	 <#assign i=1>
	<#list directory_list_associate as directory>
		
		if(id_directory==${directory.code})
		{
			add_entry_${i}(listEntry);
		}
		<#assign i=i+1>
	</#list>

	
	p.appendChild(label);
	p.appendChild(listEntry);
	p.appendChild(document.createElement("br"));
	p.appendChild(label2);
	p.appendChild(text);

	
	form.insertBefore(p,form.childNodes[13]);
 }
	<#assign i=1>
 <#list entry_list_associate as entry_list>

	function add_entry_${i}(listEntry)
	{
		<#list entry_list as entryTmp>
			var option${entryTmp.idEntry} = document.createElement("option");
			option${entryTmp.idEntry}.text="${entryTmp.title}";

			var value${entryTmp.idEntry} = document.createAttribute("value");
			value${entryTmp.idEntry}.nodeValue = "${entryTmp.idEntry}";

			option${entryTmp.idEntry}.setAttributeNode(value${entryTmp.idEntry});

			if(${entry.entryAssociate}==${entryTmp.idEntry})
			{
				var selected${entryTmp.idEntry} = document.createAttribute("selected");
				selected${entryTmp.idEntry}.nodeValue = "selected";
				option${entryTmp.idEntry}.setAttributeNode(selected${entryTmp.idEntry});
				
			}
			
			listEntry.appendChild(option${entryTmp.idEntry});
		</#list>
	}
	<#assign i=i+1>

 </#list>

 var agt=navigator.userAgent.toLowerCase();

 var is_konq = (agt.indexOf('konqueror') != -1);
 var is_safari = ((agt.indexOf('safari')!=-1)
&&(agt.indexOf('mac')!=-1))?true:false;
 var is_khtml  = (is_safari || is_konq);
 var is_gecko = ((!is_khtml)&&(navigator.product)
&&(navigator.product.toLowerCase()=="gecko"))?true:false;
 
 var is_fx = ((agt.indexOf('mozilla/5')!=-1) && (agt.indexOf('spoofer')==-1) &&
         (agt.indexOf('compatible')==-1) && (agt.indexOf('opera')==-1)  &&
         (agt.indexOf('webtv')==-1) && (agt.indexOf('hotjava')==-1)     &&
         (is_gecko) && ((navigator.vendor=="Firefox")||(agt.indexOf('firefox')!=-1)));
 if(is_fx)
 {
	 select_associate();
	 
	 refresh_list(${id_directory_associate});
 }
 
 </script>