<#include "/admin/util/editor/editor.html" />
<#assign id_group=9>
<#list entry_type_list as entryType>
<#if entryType.group>
<#assign id_group=entryType.idType>
</#if>	
</#list>
<div class="row-fluid">
	<div class="span12">
        <fieldset>
            <legend>#i18n{directory.modify_directory.title} "${directory.title}"</legend>
			<ul class="nav nav-tabs" id="dirPanels">
				<li class="active" >
					<a href="#panel1" data-toggle="tab" >#i18n{directory.modify_directory.manage_entry.title}</a>
				</li>
				<li>
					<a href="#panel2" data-toggle="tab" >#i18n{directory.create_directory.label_advancedsettings}</a>
				</li>
			</ul>
			<div class="tab-content">
				<div class="tab-pane active" id="panel1">
					<div class="well well-small clearfix">
					<#if id_group?exists>
						<form class="form-inline pull-left spaced" method="post"  action="jsp/admin/plugins/directory/DoCreateEntry.jsp?id_type=${id_group}#list">
							<label  for="title">#i18n{directory.modify_directory.manage_entry.label_insert_group}</label>
							<input type="text" size="60" name="title" />
							<button class="btn btn-primary btn-small" type="submit" title="#i18n{directory.modify_directory.manage_entry.button_insert_group}">
								<i class="icon-plus icon-white"></i>
							</button>
						</form>
					</#if>
					<form class="form-inline pull-left spaced" method="post"  action="jsp/admin/plugins/directory/CreateEntry.jsp">
						<label  for="id_type">#i18n{directory.modify_directory.manage_entry.label_insert_entry}</label>
						<select name="id_type" id="id_type">
							<option value="-1"></option>
							<#list entry_type_list as entryType>
								<#if !entryType.group && ( !entryType.myLuteceUser || entryType.myLuteceUser && 
									( entryType.idType = id_entry_type_mylutece_user && is_active_mylutece_authentification || 
									entryType.idType = id_entry_type_remote_mylutece_user && is_user_attributes_service_enable ) ) >
									<option value="${entryType.idType}">#i18n{${entryType.titleI18nKey}}</option>
								</#if>
							</#list>
						</select>
						<button class="btn btn-primary btn-small" type="submit" title="#i18n{directory.modify_directory.manage_entry.button_insert_entry}">
							<i class="icon-plus icon-white"></i>
						</button>
					</form>
					</div>
					<@paginationAdmin paginator=paginator combo=1/>
					<!--  Mass action -->
					<form class="form form-inline" method="post" action="jsp/admin/plugins/directory/DoChangeOrderEntry.jsp" style="margin 0px">
						<input name="id_directory" value="${directory.idDirectory}" type="hidden" />
						<#if entry_group_list?has_content>
							<!-- List all entry of type group  -->
							<@combo name="id_entry_group" default_value="-1" items=entry_group_list />
						</#if>
						<button type="submit" class="btn btn-primary btn-small" name="move">
							<i class="icon-ok icon-white"></i>&nbsp;#i18n{directory.modify_directory.moveAll}
						</button>
						<!--  Table of entry -->
						<table class="table table-striped table-condensed" >
							<thead>
								<tr> 
									<th><input type="checkbox" name="selectAll" id="selectAll" value="selectAll" title="#i18n{directory.modify_directory.selectAll}" /></th>
									<th>#i18n{directory.modify_directory.manage_entry.row_title}</th>
									<th>#i18n{directory.modify_directory.manage_entry.row_type}</th>
									<th>#i18n{directory.modify_directory.order}</th>
									<th>#i18n{directory.modify_directory.manage_entry.row_actions}</th>
								</tr>
							</thead>
							<tbody>
							<#if entry_list?has_content>
							<#list entry_list as entry>
								<tr>
									<td>			
										<!--  add checkbox if entry isn't a group -->		 	
										<#if !entry.entryType.group>
											<input type="checkbox" name="id_entry" value="${entry.idEntry!}" title="#i18n{directory.modify_directory.select}" />
										</#if>
									</td>
									<#if entry.entryType.group>
										<td><i class="icon-chevron-right"></i>&nbsp;${entry.title}</td>
									<#elseif entry.parent?exists>
										<td>
											<blockquote><#if entry.entryType.comment>${entry.comment}<#else>${entry.title}</#if></blockquote>
										</td>
									<#else>
										<td><#if entry.entryType.comment>${entry.comment}<#else>${entry.title}</#if></td>
									</#if>			
									<td><#if !entry.entryType.group>#i18n{${entry.entryType.titleI18nKey}}</#if></td>
									<!--  Change the order of the attribute -->
									<#if entry.parent?exists>
										<td>
											<blockquote>
												<@comboOrders name="order_id_${entry.idEntry!}" default_value=entry.position idParent=entry.parent.idEntry />
												<button class="btn btn-primary btn-small" type="submit" title="#i18n{directory.modify_directory.move}" name="move_${entry.idEntry!}" value="${entry.idEntry!}">
													<i class="icon-resize-full icon-white"></i>
												</button>
											</blockquote>
										</td>
									<#else>
										<td>
											<div class="input-append">
											<@comboOrders name="order_id_${entry.idEntry!}" default_value=entry.position idParent=0 />
											<button class="btn btn-primary" type="submit" title="#i18n{directory.modify_directory.move}" name="move_${entry.idEntry!}" value="${entry.idEntry!}" >
												<i class="icon-ok icon-white"></i>
											</button>
											</div>
										</td>
									</#if> 		
									<td>
										<a class="btn btn-primary btn-small" href="jsp/admin/plugins/directory/ModifyEntry.jsp?id_entry=${entry.idEntry}"  title="#i18n{directory.modify_directory.manage_entry.edit}" >
											<i class="icon-edit icon-white"></i>
										</a>
										<#if entry.parent?exists>
										<a class="btn btn-primary btn-small" href="jsp/admin/plugins/directory/DoMoveOutEntry.jsp?id_entry=${entry.idEntry}#list"  title="#i18n{directory.modify_directory.manage_entry.title_go_out} " >
										   <i class="icon-chevron-right icon-white"></i>
										</a>
										<#elseif !entry.entryType.group>
										<a class="btn btn-primary btn-small" href="jsp/admin/plugins/directory/MoveEntry.jsp?id_entry=${entry.idEntry}#list"  title="#i18n{directory.modify_directory.manage_entry.title_move}" >
											<i class="icon-move icon-white"></i>
										</a>
										</#if>
										<#if !entry.entryType.group>
											<a class="btn btn-primary btn-small" href="jsp/admin/plugins/directory/DoCopyEntry.jsp?id_entry=${entry.idEntry}#list"  title="#i18n{directory.modify_directory.manage_entry.title_copy}" >
												<i class="icon-plus-sign icon-white"></i>
											</a>
										</#if>	 
											<a class="btn btn-danger btn-small" href="jsp/admin/plugins/directory/ConfirmRemoveEntry.jsp?id_entry=${entry.idEntry}#list"  title="#i18n{directory.modify_directory.manage_entry.title_delete}" >
												<i class="icon-trash icon-white"></i>
											</a>
									</td>
								</tr>
							</#list>
							</#if>
							</tbody> 
						</table> 
					</form>
					<@paginationAdmin paginator=paginator combo=1 />
				</div>
				<div class="tab-pane" id="panel2">
					<form  action="jsp/admin/plugins/directory/DoModifyDirectory.jsp" method="post" name="" id="" >
					<input name="id_directory" value="${directory.idDirectory}" type="hidden" />
					<div class="row-fluid">
						<div class="span9 form-horizontal">
							<div class="control-group">
								<label class="control-label" for="title">#i18n{directory.create_directory.label_title} *  </label>
								<div class="controls">
									<input type="text" name="title" id="title"class="input-xlarge" value="${directory.title}" maxlength="255" />
									<p class="help-block">#i18n{directory.create_directory.label_title_comment}</p>
								</div>
							</div>
							<div class="control-group">
								<label class="control-label" for="description"> #i18n{directory.create_directory.label_description} * </label>
								<div class="controls">
									<textarea name="description" class="span6" rows="2">${directory.description}</textarea>
									<p class="help-block">#i18n{directory.create_directory.label_description_comment}</p>
								</div>
							</div>
							<div class="control-group">
								<label class="control-label" for="workgroup">#i18n{directory.create_directory.label_workgroup}  </label>
								<div class="controls">
									<@combo name="workgroup"  items=user_workgroup_list default_value=directory.workgroup />
									<p class="help-block">#i18n{directory.create_directory.label_workgroup_comment}</p>
								</div>
							</div>
							<#if role_list?exists >
								<div class="control-group">
									<label class="control-label" for="role">#i18n{directory.create_directory.label_role}  </label>
									<div class="controls">
										<#if directory.roleKey?exists >
											<@combo name="role_key" default_value=directory.roleKey items=role_list />
										<#else>
											<@combo name="role_key" default_value="none" items=role_list />
										</#if>	
										<p class="help-block">#i18n{directory.create_directory.label_role}</p>
									</div>
								</div>
							</#if>	
							<div class="control-group">
								<label class="control-label" for="id_form_search_template">#i18n{directory.create_directory.label_form_search_template}</label>
								<div class="controls">
									<@combo name="id_form_search_template" default_value=directory.idFormSearchTemplate items=form_search_template_list />
									<p class="help-block">#i18n{directory.create_directory.label_form_search_template_comment}</p>
								</div>
							</div>
							<div class="control-group">
								<label class="control-label" for="id_result_list_template">#i18n{directory.create_directory.label_result_list_template}</label>
								<div class="controls">
									<@combo name="id_result_list_template" default_value=directory.idResultListTemplate items=result_list_template_list />
									<p class="help-block">#i18n{directory.create_directory.label_result_list_template_comment}</p>
								</div>
							</div>
							<div class="control-group">
								<label class="control-label" for="id_result_record_template">#i18n{directory.create_directory.label_result_record_template}</label>
								<div class="controls">
									<@combo name="id_result_record_template" default_value=directory.idResultRecordTemplate items=result_record_template_list />
									<p class="help-block">#i18n{directory.create_directory.label_result_record_template_comment}</p>
								</div>
							</div>
							<div class="control-group">
								<label class="control-label" for="number_record_per_page">#i18n{directory.create_directory.label_number_record_per_page} * </label>
								<div class="controls">
									<input type="text" name="number_record_per_page" id="number_record_per_page" class="input-mini" value="<#if directory.numberRecordPerPage!=-1>${directory.numberRecordPerPage}</#if>">
									<p class="help-block">#i18n{directory.create_directory.label_number_record_per_page_comment}</p>
								</div>
							</div>
							<#if workflow_selected?exists>
								<div class="control-group">
									<label class="control-label" for="id_workflow_list">#i18n{directory.create_directory.label_worflow_list}  </label>
									<div class="controls">
										<@combo name="id_workflow_list" default_value=workflow_selected items=workflow_list />
									</div>
								</div>
								<div class="control-group">
									<label class="control-label" for="id_workflow_list">#i18n{directory.modify_directory.labelWorflowStateToRemoveRecords}  </label>
									<div class="controls">
										<@combo name="id_workflow_state" default_value=directory.idWorkflowStateToRemove items=workflow_state_list />
										<p class="help-block">#i18n{directory.modify_directory.labelWorflowStateToRemoveRecordsHelp}</p>
									</div>
								</div>
								<#if workflow_state_filter_search>
									<div class="control-group">
										<label class="control-label" for="workflow_state_filter_search">
											#i18n{directory.create_directory.label_state_search} :
										</label>  
										<div class="controls">
											<input type="radio" name="workflow_state_filter_search" value="1" <#if workflow_state_filter_search_selected="1">checked="checked"</#if>>#i18n{directory.create_directory.label_radio_state_search}
											<input type="radio" name="workflow_state_filter_search" value="2" <#if workflow_state_filter_search_selected="2">checked="checked"</#if>>#i18n{directory.create_directory.label_radio_state_search_complementary}
											<input type="radio" name="workflow_state_filter_search" value="3" <#if workflow_state_filter_search_selected="3">checked="checked"</#if>>#i18n{directory.create_directory.label_radio_state_search_no}
										</div>
									</div>
								</#if>
							</#if>
							<div class="control-group">
								<label class="control-label" for="unavailability_message">#i18n{directory.create_directory.label_unavailability_message} * : </label>
								<div class="controls">
									<textarea name="unavailability_message" id="unavailability_message" rows="20" style="width:50%;"  class="richtext"  ><#if directory.unavailabilityMessage?exists >${directory.unavailabilityMessage}</#if></textarea>
									<p class="help-block">#i18n{directory.create_directory.label_unavailability_message_comment}</p>
								</div>
							</div>
						</div>
						<div class="span3">
							<label for="frontOfficeTitle">#i18n{directory.create_directory.label_title_front} </label>
							<input type="text" name="front_office_title" id="" class="input-xlarge" value="${directory.frontOfficeTitle!}" maxlength="255" />
							<p class="help-block">#i18n{directory.create_directory.label_title_front_comment}</p>
							<div class="well well-small">
								<p><strong>#i18n{directory.create_directory.label_show_date_creation}</strong></p>
								<label class="checkbox" for="date_shown_in_result_list">
									<input name="date_shown_in_result_list" id="date_shown_in_result_list" value="1" type="checkbox" <#if directory.isDateShownInResultList()>checked="checked"</#if>/>
									#i18n{directory.create_entry.label_shown_in_result_list}
								</label>
								<label class="checkbox" for="date_shown_in_result_record">
									<input name="date_shown_in_result_record" id="date_shown_in_result_record" value="1" type="checkbox" <#if directory.isDateShownInResultRecord()>checked="checked"</#if>/>
									#i18n{directory.create_entry.label_shown_in_result_record}
								</label>
								<label class="checkbox" for="date_shown_in_history">
									<input name="date_shown_in_history" id="date_shown_in_history" value="1" type="checkbox" <#if directory.isDateShownInHistory()>checked="checked"</#if>/>
									#i18n{directory.create_entry.label_shown_in_history}
								</label>
								<label class="checkbox" for="date_shown_in_export">	
									<input name="date_shown_in_export" id="date_shown_in_export" value="1" type="checkbox" <#if directory.isDateShownInExport()>checked="checked"</#if>/>
									#i18n{directory.create_entry.label_shown_in_export}
								</label>
								<label class="checkbox" for="indexed">	
									<input id="indexed" name="date_shown_in_search" value="1" type="checkbox"  <#if directory.isDateShownInSearch()>checked="checked"</#if> />
									#i18n{directory.create_entry.label_indexed}
								</label>
								<blockquote id="show_multiple_search_fields" <#if !directory.isDateShownInSearch()>data="no"</#if>>
									<label class="checkbox" for="show_multiple_search_fields">	
										<input name="date_shown_in_multi_search" id="date_shown_in_multi_search" value="1" type="checkbox" <#if directory.isDateShownInMultiSearch()> checked="checked"</#if>>
										#i18n{directory.create_entry.label_multiple_search_fields}
									</label> 
									<label class="checkbox" for="date_shown_in_advanced_search">		   
										<input name="date_shown_in_advanced_search" id="date_shown_in_advanced_search" value="1" type="checkbox" <#if directory.isDateShownInAdvancedSearch()>checked="checked"</#if>/>		
										#i18n{directory.create_entry.label_shown_in_advanced_search}
									</label> 
								</blockquote>
							</div>
							<div class="well well-small">
								<p><strong>#i18n{directory.create_directory.label_show_date_modification}</strong></p>
								<label class="checkbox" for="date_modification_shown_in_result_list">
									<input name="date_modification_shown_in_result_list" id="date_modification_shown_in_result_list" value="1" type="checkbox" <#if directory.isDateModificationShownInResultList()>checked="checked"</#if>/>
									#i18n{directory.create_entry.label_shown_in_result_list}
								</label>
								<label class="checkbox" for="date_modification_shown_in_result_record">				
									<input name="date_modification_shown_in_result_record" id="date_modification_shown_in_result_record" value="1" type="checkbox" <#if directory.isDateModificationShownInResultRecord()>checked="checked"</#if>/>
									#i18n{directory.create_entry.label_shown_in_result_record}
								</label>
								<label class="checkbox" for="date_modification_shown_in_history">	
									<input name="date_modification_shown_in_history" id="date_modification_shown_in_history" value="1" type="checkbox" <#if directory.isDateModificationShownInHistory()>checked="checked"</#if>/>
									#i18n{directory.create_entry.label_shown_in_history}
								</label>
								<label class="checkbox" for="date_modification_shown_in_export">	
									<input name="date_modification_shown_in_export" id="date_modification_shown_in_export" value="1" type="checkbox" <#if directory.isDateModificationShownInExport()>checked="checked"</#if>/>
									#i18n{directory.create_entry.label_shown_in_export}
								</label>
								<label class="checkbox" for="date_modification_indexed">		
									<input id="date_modification_indexed" name="date_modification_shown_in_search" value="1" type="checkbox"  <#if directory.isDateModificationShownInSearch()>checked="checked"</#if> />
									 #i18n{directory.create_entry.label_indexed}
								</label>
								<blockquote id="date_modification_show_multiple_search_fields">
									<label class="checkbox" for="date_modification_shown_in_multi_search">
										<input name="date_modification_shown_in_multi_search" id="date_modification_shown_in_multi_search" value="1" type="checkbox" <#if directory.isDateModificationShownInMultiSearch()>checked="checked"</#if>>
										#i18n{directory.create_entry.label_multiple_search_fields}
									</label>
									<label class="checkbox" for="date_modification_shown_in_advanced_search">				
										<input name="date_modification_shown_in_advanced_search" id="date_modification_shown_in_advanced_search" value="1" type="checkbox" <#if directory.isDateModificationShownInAdvancedSearch()>checked="checked"</#if>/>	
										#i18n{directory.create_entry.label_shown_in_advanced_search}
									</label>
								</blockquote>
								<label class="checkbox" for="activate_directory_record">
									<input name="activate_directory_record" id="activate_directory_record" value="1" type="checkbox" <#if directory.isRecordActivated()>checked="checked"</#if>/>
									#i18n{directory.create_directory_record.activate_directory_record}
								</label>
								<p class="help-block"> #i18n{directory.create_directory_record.activate_directory_record_comment}</p>
								<label for="is_indexed">
									<input name="is_indexed" id="is_indexed" value="1" type="checkbox" <#if directory.isIndexed(  )>checked="checked"</#if>/>
									#i18n{directory.modify_directory.label.is_indexed}
								</label>
								<p class="help-block"> #i18n{directory.modify_directory.label.is_indexed_comment}
								<label class="checkbox" for="is_search_operator_or">#i18n{directory.create_directory.label.is_search_operator_or}
									<input name="is_search_operator_or" id="is_search_operator_or" value="1" type="checkbox"  <#if directory.isSearchOperatorOr( )>checked="checked"</#if>/>
								</label>
								<p class="help-block"> #i18n{directory.create_directory.label.is_search_operator_or_comment}</p>
								
								<label  for="id_sort_entry">#i18n{directory.modify_directory.label_sort_entry}</label>
								<select name="id_sort_entry" id="id_sort_entry">
									<option value=""></option>
									<option value="dateCreation" <#if directory.idSortEntry?? && directory.idSortEntry = 'dateCreation' >selected="selected"</#if> >
										#i18n{directory.entry_type_date_creation.title}
									</option>
									<option value="dateModification" <#if directory.idSortEntry?? && directory.idSortEntry = 'dateModification' >selected="selected"</#if> >
										#i18n{directory.entry_type_date_modification.title}
									</option>
									<#list entry_list as entry>
										<#if entry.sortable>
											<option value="${entry.idEntry}" <#if directory.idSortEntry?? && entry.idEntry?string = directory.idSortEntry>selected="selected"</#if>>${entry.title}</option>
										</#if>
									</#list>
								</select>
								<label for="asc_sort" class="checkbox">
									<input name="asc_sort" id="asc_sort" value="1" type="checkbox" <#if directory.isAscendingSort()>checked="checked"</#if>/>
									#i18n{directory.modify_directory.label_asc_sort}
								</label>
								<label for="id_sort_entry_front">#i18n{directory.modify_directory.label_sort_entry_front}</label>
								<select name="id_sort_entry_front" id="id_sort_entry_front">
									<option value=""></option>
									<option value="dateCreation" <#if directory.idSortEntryFront?? && directory.idSortEntryFront = 'dateCreation' >selected="selected"</#if> >
											#i18n{directory.entry_type_date_creation.title}
									</option>
									<option value="dateModification" <#if directory.idSortEntryFront?? && directory.idSortEntryFront = 'dateModification' >selected="selected"</#if> >
											#i18n{directory.entry_type_date_modification.title}
									</option>
									<#list entry_list as entry>
										<#if entry.sortable>
											<option value="${entry.idEntry}" <#if directory.idSortEntryFront?? && entry.idEntry?string = directory.idSortEntryFront>selected="selected"</#if>>${entry.title}</option>
										</#if>
									</#list>
								</select>
								</label>	
								<label for="asc_sort_front" class="checkbox">
								<input name="asc_sort_front"  id="asc_sort_front" value="1" type="checkbox" <#if directory.isAscendingSortFront()>checked="checked"</#if>/>
									#i18n{directory.modify_directory.label_asc_sort_front}
								</label>
							</div>
						</div>	
					</div>
					<div class="row-fluid">
						<div class="span12">
							<div class="form-actions">
								<button type="submit" class="btn btn-primary btn-small"  name="save">
									<i class="icon-ok icon-white"></i>&nbsp;#i18n{directory.create_directory.button_save}
								</button>
								<button type="submit" class="btn btn-primary btn-small" name="apply">
									<i class="icon-ok-sign icon-white"></i>&nbsp;#i18n{directory.modify_directory.button_apply}
								</button>
								<button type="submit" class="btn btn-small" name="cancel">
									<i class="icon-remove-circle"></i>&nbsp;#i18n{directory.create_directory.button_cancel}
								</button>
							</div>
						</div>
					</div>
					</form>
				</div>
			</div>
		</fieldset>
	</div>
</div>

<script>

$(document).ready(function() {
    // Function to activate the tab
    function activateTab() {
        var activeTab = $('[href=' + window.location.hash.replace('/', '') + ']');
        activeTab && activeTab.tab('show');
    }

    // Trigger when the page loads
    activateTab();


	<#if directory.isDateShownInSearch()>$("#show_multiple_search_fields").show();<#else>$("#show_multiple_search_fields").hide();</#if>
	<#if directory.isDateModificationShownInSearch()>$("#date_modification_show_multiple_search_fields").show();<#else>$("#date_modification_show_multiple_search_fields").hide();</#if>

	doDisplayAdvancedSettings();
	
	if( $("#show_multiple_search_fields").attr("data")=="no"){
		$("#show_multiple_search_fields").hide();
	}
	if( $("#date_modification_show_multiple_search_fields").attr("data")=="no"){
		$("#date_modification_show_multiple_search_fields").hide();
		
	}
	
	$("#selectAll").change( function() {
    if ( $(this).attr("checked") ){
		// check all
        $("input[name='id_entry']").prop( "checked", "checked");
		} else {
        // uncheck all
        $("input[name='id_entry']").prop( "checked", "");
		}
    });
	
	$("#tgAdvancedSettings").click(function () { 
		$(this).toggle();
		doDisplayAdvancedSettings();
		return false;
    });
	
	$("#tgAdvancedSettingsDown").click(function () { 
		$(this).toggle();
		$("#tgAdvancedSettingsUp").toggle();
		$("#main-detail").toggle();
		return false;
    });
	
	$("#tgAdvancedSettingsUp").click(function () {
		$(this).toggle();
		$("#tgAdvancedSettingsDown").toggle();
		$("#main-detail").toggle();
		return false;
    });
	
	$("#tgAdvancedSettingsBack").click(function () { 
		doDisplayAdvancedSettings();
		$("#tgAdvancedSettings").toggle();
		return false;
    });
	
	$("#indexed").click(function () { 
		$("#show_multiple_search_fields").toggle();
    });
	
	$("#date_modification_indexed").click(function () { 
		$("#date_modification_show_multiple_search_fields").toggle();
    });
});

function doDisplayAdvancedSettings(){
	$("#advanced_settings").toggle();
	$("#main").toggleClass("span12").toggleClass("span9");
	$("#main-detail").toggle();
	$("#tgAdvancedSettingsUp").toggle();
}

</script>

<@initEditor />

<script src="js/jquery/plugins/ui/jquery-ui-1.9.2.custom.min.js"></script>
<script src="js/jquery/plugins/ui/ui.datepicker-fr.js"></script>
<@getDatePicker idField="date_limite" language=locale />

<#macro comboOrders name default_value idParent >
<select id="${name}" name="${name}" class="input-mini" >
	<#list mapChild[idParent!?string] as i>
    <#if default_value == i>
		<option selected="selected" value="${i}" >${i}</option>
	<#else>
		<option value="${i}" >${i}</option>
     </#if>
</#list>
</select>
</#macro>
